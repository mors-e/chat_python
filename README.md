# Проект ЧАТ написан на python  
  
Чтобы запустить проект нужно прописать некотрые команды  
для начала нужно создать окружение env  

```python
python -m venv env
```

## Далее активировать env и установить библиотеки 

```python 
pip install -r requirements.txt
```

## Чтобы запустить сервер и клиентов
```
docker-compose -f docker-compose-server.yml up -d
```
- запуск севера  
```
docker-compose -f docker-compose-client.yml up -d
```
- запуск клиента

### Чтобы запустить несколько клиентов сразу (Тестирование на одном компе)  
**нужно зайти в File -> Settings -> Tools -> Terminal  
в поле Environment varibales следует прописать PYTHONPATH=.  
перезапустить Terminal  
и прописать команду**

```python
python client/client.py
```  
**каждый раз создаётся новый клиент**

## Подключение клиентов и создание комнат

При подключении запуске клиента вас просят ввести имя и номер комнаты   
клиентов с 2-мя одинаковыми именами не может находиться в 1 комнате  
когда клиент пишет номер комнаты, которой не существует создаётся новая  
и клиент заходит туда  
**подключение происходит по ссылке '{WS_URL}/{room_name}?name={name}'**

## Работа сервиса
### Сообщения
Сообщение имеет вид json Message(text=text, time=datetime.now(), user=user)  

### listen_input
функция следит за вводом сообщения от клиента и отправкой сообщения

При подключении клиента к новой комнате  
активируется 2 бесконечные функции listen_room и listen_client

### listen_room  
бесконечно смотрит за комнатой и ищет новые сообщения,  
как только новое сообщение появляется в redis  
отправляет всем пользователям по данному url  

### listen_client  
следит за каждым клиентом  
при подключении отправляет сообщение в комнату о подключении нового клиента  
при отключении отправляет сообщение в комнату о отключении  



